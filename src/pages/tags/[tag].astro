---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const allPosts = await getCollection("blog");
  const uniqueTags = [...new Set(allPosts.map((post) => post.data.tags).flat())];

  return uniqueTags.map((tag) => {
    const filteredPosts = allPosts.filter((post) => post.data.tags.includes(tag));
    return {
      params: { tag },
      props: { posts: filteredPosts },
    };
  });
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<BaseLayout title={`包含标签 #${tag} 的文章`}>
    <div class="container mx-auto max-w-4xl py-8 md:py-12 lg:py-24">
        <h1 class="mb-10 text-3xl font-bold">包含标签 <span class="text-primary">#{tag}</span> 的文章</h1>
        
        <div class="grid gap-10 sm:grid-cols-2">
            {posts.map((post) => (
                <article class="group relative flex flex-col space-y-2">
                    {post.data.heroImage && (
                        <img
                            src={post.data.heroImage}
                            alt={post.data.title}
                            width={804}
                            height={452}
                            class="rounded-md border bg-muted transition-colors"
                        />
                    )}
                    <h2 class="text-2xl font-extrabold pb-2">
                        <a href={`/blog/${post.slug}`} class="block transition-colors hover:text-primary">
                            {post.data.title}
                        </a>
                    </h2>
                    <p class="text-muted-foreground pb-2">{post.data.description}</p>
                    <p class="text-sm text-muted-foreground">
                        {post.data.pubDate.toLocaleDateString()}
                    </p>
                    <a href={`/blog/${post.slug}`} class="absolute inset-0">
                        <span class="sr-only">阅读文章</span>
                    </a>
                </article>
            ))}
        </div>
    </div>
</BaseLayout>
